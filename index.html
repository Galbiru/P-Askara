<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Askara - Survey Panel</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap");
    :root {
      --accent: #00f2fe;
      --accent-soft: #4facfe;
      --text-main: #ffffff;
      --text-muted: #cbd5e1;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    body {
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .app-shell {
      width: 100%;
      max-width: 500px;
      border-radius: 24px;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      padding: 25px;
      position: relative;
      box-sizing: border-box;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      border: none;
      color: #fff;
      padding: 14px;
      border-radius: 12px;
      width: 100%;
      cursor: pointer;
      font-weight: 600;
      margin-top: 15px;
      font-size: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-primary:active { transform: scale(0.98); }

    .grid-container { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 15px; }

    .card-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      box-sizing: border-box;
    }
    .card-item:hover {
      background: rgba(255,255,255,0.15);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .badge-circle {
      min-width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: bold;
      color: #fff;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .back-link {
      color: var(--text-main);
      cursor: pointer;
      background: rgba(255,255,255,0.1);
      border: none;
      margin-bottom: 15px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      transition: 0.2s;
    }
    .back-link:hover { background: rgba(255,255,255,0.2); }

    h3 { margin-top: 5px; border-left: 4px solid var(--accent); padding-left: 10px; font-size: 1.2rem;}

    .search-box {
      width: 100%;
      padding: 12px 15px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      box-sizing: border-box;
      font-family: inherit;
      outline: none;
      transition: 0.3s;
    }
    .search-box:focus {
      border-color: var(--accent);
      background: rgba(0, 0, 0, 0.5);
    }

    @media (max-width: 600px) {
      body { padding: 10px; align-items: flex-start; }
      .app-shell { padding: 15px; width: 100%; }
      h1 { font-size: 1.4rem; }
      .card-item { padding: 12px; gap: 10px; }
      .btn-primary { padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div id="app-header" style="display:none; margin-bottom: 15px;">
        <div id="stats-dashboard" style="display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; margin-bottom: 10px;">
            <span style="font-size: 0.85rem;">Visited: <b id="progress-text" style="color: var(--accent);">0</b></span>
            <div style="font-size: 0.7rem; color: var(--text-muted);">Total: <span id="total-links">0</span></div>
        </div>
        <input type="text" id="search-input" placeholder="üîç Cari Pulau, Provinsi..." class="search-box">
    </div>

    <div id="view-welcome">
      <div style="font-size: 0.7rem; color: var(--accent-soft); letter-spacing: 2px;">ACORN CONSULTANT</div>
      <h1 style="font-size:1.6rem; margin: 5px 0;">Project Askara<br>Survey Hub</h1>
      <p style="color:var(--text-muted); font-size: 0.85rem;">Welcome to Askara Projects</p>
      <button class="btn-primary" onclick="showView('view-islands')">MASUK DASHBOARD</button>
    </div>

    <div id="view-islands" style="display:none;">
      <button class="back-link" onclick="showView('view-welcome')">‚Üê Kembali</button>
      <h3>Pilih Pulau / Region</h3>
      <div id="islands-grid" class="grid-container"></div>
    </div>

    <div id="view-provinces" style="display:none;">
      <button class="back-link" onclick="showView('view-islands')">‚Üê Pilih Pulau</button>
      <h3 id="island-title"></h3>
      <div id="provinces-grid" class="grid-container"></div>
    </div>

    <div id="view-users" style="display:none;">
      <button id="btn-back-to-provinces" class="back-link">‚Üê Pilih Provinsi</button>
      <h3 id="province-title"></h3>
      <div id="users-grid" class="grid-container"></div>
    </div>

    <div id="view-links" style="display:none;">
      <button id="btn-back-to-users" class="back-link">‚Üê Pilih User</button>
      <h3 id="user-title"></h3>
      <div id="links-grid" class="grid-container"></div>
    </div>
  </div>

  <script src="data.js"></script>
  <script>
    let currentPos = 0;

    // --- DATA MAPPING ---
    const finalData = DATA_STRUCTURE.map(group => {
      return {
        islandName: group.island,
        provinces: group.provinces.map(p => {
          let users = [];
          let numUsers = p.q / 10;
          for (let i = 1; i <= numUsers; i++) {
            users.push({
              userName: `User${i}`,
              links: ALL_LINKS.slice(currentPos, currentPos + 10)
            });
            currentPos += 10;
          }
          return { provName: p.n, users: users };
        })
      };
    });

    // --- PROGRESS TRACKING ---
    const STORAGE_KEY = 'askara_visited_links';
    let visitedLinks = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'));

    function saveProgress(link) {
      visitedLinks.add(link);
      localStorage.setItem(STORAGE_KEY, JSON.stringify([...visitedLinks]));
      updateStats();
    }

    window.resetProgress = function() {
      if(confirm('Hapus semua riwayat pengerjaan?')) {
        visitedLinks.clear();
        localStorage.removeItem(STORAGE_KEY);
        updateStats();
        location.reload();
      }
    };

    function updateStats() {
      const total = ALL_LINKS.length;
      const visited = visitedLinks.size;
      const percent = total > 0 ? Math.round((visited/total)*100) : 0;
      const textEl = document.getElementById('progress-text');
      const totalEl = document.getElementById('total-links');
      if(textEl) textEl.innerText = `${visited}/${total}`;
      if(totalEl) totalEl.innerText = `${percent}%`;
    }

    // --- VIEW LOGIC ---
    function showView(id) {
      // Hide all views
      ['view-welcome', 'view-islands', 'view-provinces', 'view-users', 'view-links'].forEach(v => {
        const el = document.getElementById(v);
        if(el) el.style.display = 'none';
      });
      // Show target
      const target = document.getElementById(id);
      if(target) target.style.display = 'block';

      // Header Visibility
      const isWelcome = (id === 'view-welcome');
      const header = document.getElementById('app-header');
      if(header) header.style.display = isWelcome ? 'none' : 'block';

      // If going back to islands, make sure search is cleared or handled
      if(id === 'view-islands') {
          const searchInput = document.getElementById('search-input');
          if(searchInput && searchInput.value === '') {
             renderIslands();
          }
      }
    }

    // --- RENDERING ---
    function renderIslands() {
      const title = document.querySelector('#view-islands h3');
      if(title) title.innerText = 'Pilih Pulau / Region';

      const grid = document.getElementById('islands-grid');
      if(!grid) return;
      grid.innerHTML = '';

      finalData.forEach((group, i) => {
        const btn = document.createElement('button');
        btn.className = 'card-item';
        btn.innerHTML = `<div class="badge-circle">${i+1}</div><div><b>${group.islandName}</b><br><small>${group.provinces.length} Provinsi</small></div>`;
        btn.onclick = () => renderProvinces(i);
        grid.appendChild(btn);
      });
    }

    function renderProvinces(islandIdx) {
      const group = finalData[islandIdx];
      document.getElementById('island-title').innerText = group.islandName;
      const grid = document.getElementById('provinces-grid');
      grid.innerHTML = '';
      group.provinces.forEach((p, i) => {
        const btn = document.createElement('button');
        btn.className = 'card-item';
        btn.innerHTML = `<div class="badge-circle">${i+1}</div><div><b>${p.provName}</b><br><small>${p.users.length} Users</small></div>`;
        btn.onclick = () => renderUsers(islandIdx, i);
        grid.appendChild(btn);
      });
      showView('view-provinces');
    }

    function renderUsers(islandIdx, provIdx) {
      const province = finalData[islandIdx].provinces[provIdx];
      document.getElementById('province-title').innerText = province.provName;
      const grid = document.getElementById('users-grid');
      grid.innerHTML = '';
      province.users.forEach((u, i) => {
        const btn = document.createElement('button');
        btn.className = 'card-item';
        btn.innerHTML = `<div class="badge-circle">${i+1}</div><div><b>${u.userName}</b></div>`;
        btn.onclick = () => renderLinks(islandIdx, provIdx, i);
        grid.appendChild(btn);
      });
      document.getElementById('btn-back-to-provinces').onclick = () => renderProvinces(islandIdx);
      showView('view-users');
    }

    function renderLinks(islandIdx, provIdx, userIdx) {
      const user = finalData[islandIdx].provinces[provIdx].users[userIdx];
      document.getElementById('user-title').innerText = `${user.userName} (${finalData[islandIdx].provinces[provIdx].provName})`;
      const grid = document.getElementById('links-grid');
      grid.innerHTML = '';
      user.links.forEach((l, i) => {
        const isVisited = visitedLinks.has(l);
        const btn = document.createElement('button');
        btn.className = 'card-item';
        if (isVisited) {
            btn.style.opacity = '0.7';
            btn.style.borderLeft = '4px solid var(--accent)';
        }

        btn.innerHTML = `
            <div class="badge-circle" style="${isVisited ? 'background: #10b981' : ''}">${i+1}</div>
            <div style="flex:1; overflow:hidden; text-align:left;">
                <div style="font-size:0.75rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${l}</div>
                ${isVisited ? '<small style="color:#10b981; font-weight:bold;">‚úî Sudah dikerjakan</small>' : '<small style="color:var(--text-muted)">Klik untuk buka</small>'}
            </div>
        `;

        btn.onclick = () => {
            window.open(l, '_blank');
            saveProgress(l);
            // Optimistic UI update
            btn.style.opacity = '0.7';
            btn.style.borderLeft = '4px solid var(--accent)';
            const badge = btn.querySelector('.badge-circle');
            badge.style.background = '#10b981';
            const textDiv = btn.querySelector('div[style*="flex:1"]');
            if(!textDiv.innerHTML.includes('Sudah')) {
                textDiv.innerHTML = `
                    <div style="font-size:0.75rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${l}</div>
                    <small style="color:#10b981; font-weight:bold;">‚úî Sudah dikerjakan</small>
                `;
            }
        };
        grid.appendChild(btn);
      });
      document.getElementById('btn-back-to-users').onclick = () => renderUsers(islandIdx, provIdx);
      showView('view-links');
    }

    // --- SEARCH LOGIC ---
    const searchInput = document.getElementById('search-input');
    if(searchInput) {
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if (term.length === 0) {
                renderIslands();
                // Ensure we are on view-islands if we were searching
                const current = document.getElementById('view-islands');
                if(current.style.display === 'block') {
                    // Update title back
                    const title = document.querySelector('#view-islands h3');
                    if(title) title.innerText = 'Pilih Pulau / Region';
                }
                return;
            }

            // Search Provinces
            const results = [];
            finalData.forEach((island, iIdx) => {
                island.provinces.forEach((prov, pIdx) => {
                    if (prov.provName.toLowerCase().includes(term)) {
                        results.push({
                            type: 'Provinsi',
                            name: prov.provName,
                            parent: island.islandName,
                            click: () => renderUsers(iIdx, pIdx)
                        });
                    }
                });
            });

            const grid = document.getElementById('islands-grid');
            if(grid) {
                grid.innerHTML = '';

                if (results.length === 0) {
                    grid.innerHTML = `<div style="text-align:center; padding:20px; color:var(--text-muted)">Tidak ditemukan hasil untuk "${term}"</div>`;
                } else {
                    results.forEach(res => {
                        const btn = document.createElement('button');
                        btn.className = 'card-item';
                        btn.innerHTML = `
                            <div class="badge-circle" style="background:var(--accent-soft)">üìç</div>
                            <div style="text-align:left;"><b>${res.name}</b><br><small>${res.parent} (${res.type})</small></div>
                        `;
                        btn.onclick = res.click;
                        grid.appendChild(btn);
                    });
                }
            }

            const title = document.querySelector('#view-islands h3');
            if(title) title.innerText = 'Hasil Pencarian';
            showView('view-islands');
        });
    }

    // Initialize
    window.onload = () => {
      renderIslands();
      updateStats();
      showView('view-welcome');
    };
  </script>
</body>
</html>